#include <Arduino.h>
#include <Wire.h>
#include <Adafruit_AS5600.h>

// Usa o mesmo objeto do seu código original
Adafruit_AS5600 as5600;

void setup() {
  Serial.begin(115200);
  
  // Inicia I2C
  Wire.begin();

  // Tenta iniciar o sensor (igual ao seu original)
  if (!as5600.begin()) {
    Serial.println("Erro: Sensor AS5600 nao encontrado!");
    while (1); // Trava se der erro
  }
}

void loop() {
  // LÓGICA DE COMUNICAÇÃO COM LABVIEW
  // Só executa se o LabVIEW chamar (mandar algo pela serial)
  if (Serial.available() > 0) {
    
    // 1. Limpa o buffer (descarta o comando que o LabVIEW mandou)
    while(Serial.available() > 0) {
      Serial.read(); 
    }

    // 2. Lê o valor Raw (0-4095)
    // TENTATIVA 1: Usando o comando do seu código original
    // Se der erro de "no member named getAngle", troque por "readAngle()"
    int anguloRaw = as5600.getAngle(); 

    // 3. Converte para Graus (Fórmula do seu código original)
    float anguloGraus = anguloRaw * (360.0 / 4096.0);

    // 4. Envia para o LabVIEW
    // IMPORTANTE: O LabVIEW só quer o NÚMERO. 
    // Removemos os textos "Valor Raw:" e "Graus:" que tinham antes.
    Serial.println(anguloGraus, 0); // O ",0" envia o número inteiro (arredondado)
  }
}
